  <agent_config>
    <!-- Firewall Log file -->
    <localfile>
      <location>C:\Windows\System32\LogFiles\Firewall\pfirewall.log</location>
      <log_format>syslog</log_format>
    </localfile>
    <localfile>
      <log_format>eventchannel</log_format>
      <location>Microsoft-Windows-Windows Firewall With Advanced Security/Firewall</location>
    </localfile>
    <!-- Configure Windows Defender (From 'Guide to Integrate Wazuh with Antivirus Software' by Josh Robertson -->
    <localfile>
      <location>Microsoft-Windows-Windows Defender/Operational</location>
      <log_format>eventchannel</log_format>
    </localfile>
    <!-- Osquery integration -->
    <wodle name="osquery">
      <disabled>yes</disabled>
      <run_daemon>yes</run_daemon>
      <bin_path>C:\Program Files\osquery\osqueryd</bin_path>
      <log_path>C:\Program Files\osquery\log\osqueryd.results.log</log_path>
      <config_path>C:\Program Files\osquery\osquery.conf</config_path>
      <add_labels>yes</add_labels>
    </wodle>
    <!-- Windows Eventchannel integration -->
    <wodle name="windows-eventchannel" disabled="no">
      <interval>60</interval>
      <channels>
        <channel>Security</channel>
        <channel>Application</channel>
        <channel>System</channel>
      </channels>
      <logall>yes</logall>
      <debug>2</debug>
    </wodle>
    <!-- ADDED FROM https://wazuh.com/blog/monitoring-windows-resources-with-performance-counters/ -->
    <!-- CPU Usage -->
    <wodle name="command">
      <disabled>no</disabled>
      <tag>CPUUsage</tag>
      <command>Powershell -c "@{ winCounter = (Get-Counter '\Processor(_Total)\% Processor Time').CounterSamples[0] } | ConvertTo-Json -compress"</command>
      <interval>1m</interval>
      <ignore_output>no</ignore_output>
      <run_on_start>yes</run_on_start>
      <timeout>0</timeout>
    </wodle>
    <!-- Memory Usage -->
    <wodle name="command">
      <disabled>no</disabled>
      <tag>MEMUsage</tag>
      <command>Powershell -c "@{ winCounter = (Get-Counter '\Memory\Available MBytes').CounterSamples[0] } | ConvertTo-Json -compress"</command>
      <interval>1m</interval>
      <ignore_output>no</ignore_output>
      <run_on_start>yes</run_on_start>
      <timeout>0</timeout>
    </wodle>
    <!-- Network Received -->
    <wodle name="command">
      <disabled>no</disabled>
      <tag>NetworkTrafficIn</tag>
      <command>Powershell -c "@{ winCounter = (Get-Counter '\Network Interface(*)\Bytes Received/sec').CounterSamples[0] } | ConvertTo-Json -compress"</command>
      <interval>1m</interval>
      <ignore_output>no</ignore_output>
      <run_on_start>yes</run_on_start>
      <timeout>0</timeout>
    </wodle>
    <!-- Network Sent -->
    <wodle name="command">
      <disabled>no</disabled>
      <tag>NetworkTrafficOut</tag>
      <command>Powershell -c "@{ winCounter = (Get-Counter '\Network Interface(*)\Bytes Sent/sec').CounterSamples[0] } | ConvertTo-Json -compress"</command>
      <interval>1m</interval>
      <ignore_output>no</ignore_output>
      <run_on_start>yes</run_on_start>
      <timeout>0</timeout>
    </wodle>
    <!-- Disk Free -->
    <wodle name="command">
      <disabled>no</disabled>
      <tag>DiskFree</tag>
      <command>Powershell -c "@{ winCounter = (Get-Counter '\LogicalDisk(*)\Free Megabytes').CounterSamples[0] } | ConvertTo-Json -compress"</command>
      <interval>1m</interval>
      <ignore_output>no</ignore_output>
      <run_on_start>yes</run_on_start>
      <timeout>0</timeout>
    </wodle>
    <!-- Choose between plain or json format (or both) for internal logs -->
    <logging>
      <log_format>plain</log_format>
    </logging>
  </agent_config>
